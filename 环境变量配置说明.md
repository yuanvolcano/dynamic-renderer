# 环境变量配置说明

## 📋 概述

本项目支持多环境配置，通过环境变量来管理不同环境下的配置参数。支持 `development`、`test`、`production` 三个环境。

## 🗂️ 环境变量文件

| 文件名               | 说明             | Git跟踪   |
| -------------------- | ---------------- | --------- |
| `.env.development`   | 开发环境配置     | ❌ 不跟踪 |
| `.env.test`          | 测试环境配置     | ❌ 不跟踪 |
| `.env.production`    | 生产环境配置     | ❌ 不跟踪 |
| `.env.local.example` | 环境变量示例文件 | ✅ 跟踪   |

## 🚀 快速开始

### 1. 创建本地环境变量文件

```bash
# 复制示例文件
cp .env.local.example .env.local

# 根据需要修改配置
vi .env.local
```

### 2. 启动不同环境

```bash
# 开发环境
pnpm dev:h5:dev          # H5开发环境
pnpm dev:mp-weixin:dev   # 微信小程序开发环境

# 测试环境
pnpm dev:h5:test         # H5测试环境
pnpm dev:mp-weixin:test  # 微信小程序测试环境

# 生产环境（用于本地验证）
pnpm dev:h5:prod         # H5生产环境
pnpm dev:mp-weixin:prod  # 微信小程序生产环境
```

### 3. 构建不同环境

```bash
# 开发环境构建
pnpm build:h5:dev
pnpm build:mp-weixin:dev

# 测试环境构建
pnpm build:h5:test
pnpm build:mp-weixin:test

# 生产环境构建
pnpm build:h5:prod
pnpm build:mp-weixin:prod
```

## 📝 环境变量详解

### 基础配置

| 变量名             | 类型   | 说明     | 示例值                                |
| ------------------ | ------ | -------- | ------------------------------------- |
| `VITE_APP_TITLE`   | string | 应用标题 | `跨平台动态UI构建平台`                |
| `VITE_APP_VERSION` | string | 应用版本 | `1.0.0`                               |
| `VITE_APP_ENV`     | string | 应用环境 | `development` / `test` / `production` |

### API配置

| 变量名              | 类型   | 说明                | 示例值                  |
| ------------------- | ------ | ------------------- | ----------------------- |
| `VITE_API_BASE_URL` | string | API基础地址         | `http://localhost:8080` |
| `VITE_API_TIMEOUT`  | number | API超时时间（毫秒） | `10000`                 |

### 调试配置

| 变量名               | 类型    | 说明             | 示例值                              |
| -------------------- | ------- | ---------------- | ----------------------------------- |
| `VITE_APP_DEBUG`     | boolean | 是否开启调试模式 | `true` / `false`                    |
| `VITE_APP_LOG_LEVEL` | string  | 日志级别         | `debug` / `info` / `warn` / `error` |

### 平台配置

| 变量名                  | 类型   | 说明            | 示例值               |
| ----------------------- | ------ | --------------- | -------------------- |
| `VITE_MP_WEIXIN_APP_ID` | string | 微信小程序AppID | `wx1234567890abcdef` |
| `VITE_H5_ROUTER_BASE`   | string | H5路由基础路径  | `/`                  |
| `VITE_H5_PUBLIC_PATH`   | string | H5静态资源路径  | `/`                  |

### 构建配置

| 变量名               | 类型    | 说明             | 示例值           |
| -------------------- | ------- | ---------------- | ---------------- |
| `VITE_DROP_CONSOLE`  | boolean | 是否移除console  | `true` / `false` |
| `VITE_DROP_DEBUGGER` | boolean | 是否移除debugger | `true` / `false` |
| `VITE_DEV_PORT`      | number  | 开发服务器端口   | `3000`           |

## 💻 代码使用

### TypeScript类型支持

项目已配置完整的TypeScript类型声明，在代码中使用环境变量时会有智能提示：

```typescript
// 直接使用
const apiUrl = import.meta.env.VITE_API_BASE_URL;

// 使用工具函数（推荐）
import { getApiBaseUrl, isDev, envConfig } from '@/utils/env';

const apiUrl = getApiBaseUrl();
const isDebug = isDev();
const config = envConfig;
```

### 工具函数

```typescript
import {
  getAppEnv, // 获取应用环境
  isDev, // 是否开发环境
  isTest, // 是否测试环境
  isProd, // 是否生产环境
  getAppTitle, // 获取应用标题
  getApiBaseUrl, // 获取API地址
  isDebugMode, // 是否调试模式
  envConfig, // 完整环境配置
} from '@/utils/env';
```

### Vue组件中使用

```vue
<template>
  <view>
    <text>当前环境: {{ envConfig.appEnv }}</text>
    <text>API地址: {{ envConfig.apiBaseUrl }}</text>
  </view>
</template>

<script setup lang="ts">
import { envConfig } from '@/utils/env';
</script>
```

## 🔐 安全注意事项

1. **敏感信息保护**:
   - 所有 `.env.*` 文件已加入 `.gitignore`
   - 不要在环境变量中存储密码、密钥等敏感信息
   - 使用 `VITE_` 前缀的变量会被注入到客户端代码中

2. **生产环境配置**:
   - 生产环境的环境变量应通过CI/CD或服务器配置
   - 不要在代码中硬编码生产环境配置

3. **微信小程序配置**:
   - 不同环境使用不同的AppID
   - 确保测试和生产环境的AppID配置正确

## 🛠️ 故障排除

### 环境变量未生效

1. 检查变量名是否以 `VITE_` 开头
2. 重启开发服务器
3. 清除构建缓存：`rm -rf dist .vite`

### TypeScript类型错误

1. 检查 `src/types/env.d.ts` 文件是否存在
2. 重启TypeScript服务器

### 构建失败

1. 检查环境变量语法是否正确
2. 确保所有必需的环境变量都已设置

## 📚 扩展阅读

- [Vite 环境变量文档](https://vitejs.dev/guide/env-and-mode.html)
- [uniapp 环境变量](https://uniapp.dcloud.net.cn/collocation/env.html)
- [TypeScript 环境变量类型](https://vitejs.dev/guide/env-and-mode.html#intellisense-for-typescript)
