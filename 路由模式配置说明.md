# è·¯ç”±æ¨¡å¼é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®å·²æˆåŠŸä» **Hash è·¯ç”±æ¨¡å¼**åˆ‡æ¢åˆ° **History è·¯ç”±æ¨¡å¼**ï¼ŒåŒæ—¶ä¿æŒå¯¹ H5 å’Œå¾®ä¿¡å°ç¨‹åºçš„å…¼å®¹æ€§ã€‚

## ğŸ”„ è·¯ç”±æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§       | Hash æ¨¡å¼                          | History æ¨¡å¼                     |
| ---------- | ---------------------------------- | -------------------------------- |
| URL æ ¼å¼   | `https://example.com/#/pages/demo` | `https://example.com/pages/demo` |
| SEO å‹å¥½   | âŒ æœç´¢å¼•æ“ä¸è¯†åˆ« # åå†…å®¹         | âœ… URL æ›´åŠ æ¸…æ´ï¼ŒSEO å‹å¥½        |
| æœåŠ¡å™¨é…ç½® | âœ… æ— éœ€ç‰¹æ®Šé…ç½®                    | âŒ éœ€è¦é…ç½® fallback             |
| ç”¨æˆ·ä½“éªŒ   | âš ï¸ URL å¸¦ # å·                     | âœ… æ›´è‡ªç„¶çš„ URL                  |
| æµè§ˆå™¨å…¼å®¹ | âœ… æ‰€æœ‰ç°ä»£æµè§ˆå™¨                  | âœ… IE10+ æ”¯æŒ                    |

## âš™ï¸ é…ç½®è¯¦æƒ…

### 1. pages.json é…ç½®

```json
{
  "h5": {
    "router": {
      "mode": "history",
      "base": "/"
    },
    "optimization": {
      "treeShaking": {
        "enable": true
      }
    },
    "devServer": {
      "https": false
    }
  }
}
```

### 2. vite.config.mts é…ç½®

```typescript
export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');

  return {
    // é…ç½®åŸºç¡€è·¯å¾„
    base: env.VITE_H5_PUBLIC_PATH || '/',

    server: {
      // History API fallback æ”¯æŒ
      historyApiFallback: {
        index: '/index.html',
        rewrites: [
          { from: /^\/pages\/.*$/, to: '/index.html' },
          { from: /^\/.*$/, to: '/index.html' },
        ],
      },
    },
  };
});
```

### 3. ç¯å¢ƒå˜é‡é…ç½®

```bash
# H5 è·¯ç”±åŸºç¡€è·¯å¾„
VITE_H5_ROUTER_BASE=/
VITE_H5_PUBLIC_PATH=/
```

## ğŸ› ï¸ è·¯ç”±å·¥å…·å‡½æ•°

é¡¹ç›®æä¾›äº†å®Œæ•´çš„è·¨å¹³å°è·¯ç”±å·¥å…·å‡½æ•°ï¼š

### åŸºç¡€å¯¼èˆª

```typescript
import { navigateTo, navigateBack, switchTab } from '@/utils/router';

// é¡µé¢è·³è½¬
await navigateTo({
  url: '/pages/demo/demo',
  mode: 'push', // push | replace | reLaunch | switchTab
});

// è¿”å›ä¸Šé¡µ
await navigateBack(1);

// Tab é¡µé¢åˆ‡æ¢
await switchTab('/pages/index/index');
```

### æ™ºèƒ½å¯¼èˆª

```typescript
import { smartNavigate, ROUTES } from '@/utils/router';

// è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ä¸º Tab é¡µé¢
await smartNavigate(ROUTES.DEMO, { userId: 123 });
```

### URL å¤„ç†

```typescript
import { buildUrl, parseUrlQuery, getCurrentRoute } from '@/utils/router';

// æ„å»º URL
const url = buildUrl('/pages/demo/demo', { type: 'test', id: 123 });

// è§£æ URL å‚æ•°
const params = parseUrlQuery(url);

// è·å–å½“å‰è·¯ç”±
const currentPath = getCurrentRoute();
```

## ğŸŒ éƒ¨ç½²é…ç½®

### Nginx é…ç½®

History æ¨¡å¼éœ€è¦æœåŠ¡å™¨æ”¯æŒï¼Œè¯·ä½¿ç”¨æä¾›çš„ `nginx.conf.example` é…ç½®ï¼š

```nginx
# å…³é”®é…ç½® - History è·¯ç”±æ”¯æŒ
location / {
    try_files $uri $uri/ /index.html;

    # é˜²æ­¢ç¼“å­˜ index.html
    add_header Cache-Control "no-cache, no-store, must-revalidate";
}
```

### Apache é…ç½®

```apache
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>
```

### Docker + Nginx

```dockerfile
FROM nginx:alpine
COPY dist/build/h5 /usr/share/nginx/html
COPY nginx.conf.example /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

## ğŸ“± å¹³å°å…¼å®¹æ€§

### H5 ç«¯

- âœ… **History æ¨¡å¼** - ä½¿ç”¨æµè§ˆå™¨ History API
- âœ… **æ¸…æ´ URL** - æ—  # å·çš„è‡ªç„¶è·¯å¾„
- âœ… **SEO ä¼˜åŒ–** - æœç´¢å¼•æ“å‹å¥½
- âœ… **å‰è¿›/åé€€** - æ”¯æŒæµè§ˆå™¨å¯¼èˆª

### å¾®ä¿¡å°ç¨‹åºç«¯

- âœ… **é¡µé¢æ ˆç®¡ç†** - ä½¿ç”¨å°ç¨‹åºåŸç”Ÿå¯¼èˆª
- âœ… **Tab é¡µé¢** - è‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨ switchTab
- âœ… **å‚æ•°ä¼ é€’** - å®Œæ•´æ”¯æŒ URL å‚æ•°
- âœ… **ç”Ÿå‘½å‘¨æœŸ** - å…¼å®¹å°ç¨‹åºé¡µé¢ç”Ÿå‘½å‘¨æœŸ

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åœ¨é¡µé¢ä¸­ä½¿ç”¨

```vue
<template>
  <view>
    <button @click="goToDemo">å‰å¾€æ¼”ç¤ºé¡µ</button>
    <button @click="goBack">è¿”å›</button>
  </view>
</template>

<script setup lang="ts">
import { smartNavigate, navigateBack, ROUTES } from '@/utils/router';

const goToDemo = () => {
  smartNavigate(ROUTES.DEMO, { from: 'home' });
};

const goBack = () => {
  navigateBack();
};
</script>
```

### è·¯ç”±æ¼”ç¤ºç»„ä»¶

é¡¹ç›®åŒ…å«äº†å®Œæ•´çš„è·¯ç”±æ¼”ç¤ºç»„ä»¶ `RouterDemo.vue`ï¼Œå±•ç¤ºäº†ï¼š

- ğŸ  Tab é¡µé¢åˆ‡æ¢
- ğŸ”„ History å¯¼èˆªæµ‹è¯•
- ğŸ“ å¸¦å‚æ•°è·³è½¬
- ğŸ› è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º

## ğŸ” æµ‹è¯•éªŒè¯

### å¼€å‘ç¯å¢ƒæµ‹è¯•

1. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**ï¼š

   ```bash
   pnpm dev:h5:dev
   ```

2. **è®¿é—®æµ‹è¯•**ï¼š
   - é¦–é¡µï¼š`http://localhost:3000/`
   - æ¼”ç¤ºé¡µï¼š`http://localhost:3000/pages/demo/demo`
   - å¸¦å‚æ•°ï¼š`http://localhost:3000/pages/demo/demo?test=history`

3. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - âœ… ç›´æ¥è®¿é—®è·¯ç”±è·¯å¾„
   - âœ… æµè§ˆå™¨å‰è¿›/åé€€
   - âœ… åˆ·æ–°é¡µé¢ä¸æŠ¥ 404
   - âœ… Tab é¡µé¢åˆ‡æ¢
   - âœ… å¸¦å‚æ•°å¯¼èˆª

### URL æ ¼å¼å¯¹æ¯”

**Hash æ¨¡å¼ï¼ˆæ—§ï¼‰**ï¼š

```
http://localhost:3000/#/
http://localhost:3000/#/pages/demo/demo
http://localhost:3000/#/pages/demo/demo?test=hash
```

**History æ¨¡å¼ï¼ˆæ–°ï¼‰**ï¼š

```
http://localhost:3000/
http://localhost:3000/pages/demo/demo
http://localhost:3000/pages/demo/demo?test=history
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ

- âœ… Vite è‡ªåŠ¨é…ç½®äº† historyApiFallback
- âœ… æ”¯æŒçƒ­é‡è½½å’Œè·¯ç”±è·³è½¬
- âœ… å¼€å‘æœåŠ¡å™¨è‡ªåŠ¨å¤„ç† 404

### ç”Ÿäº§ç¯å¢ƒ

- âš ï¸ **å¿…é¡»é…ç½®æœåŠ¡å™¨**ï¼Œå¦åˆ™ç›´æ¥è®¿é—®è·¯ç”±ä¼š 404
- âš ï¸ **åˆ·æ–°é¡µé¢**éœ€è¦æœåŠ¡å™¨è¿”å› index.html
- âš ï¸ **é™æ€èµ„æº**è·¯å¾„éœ€è¦æ­£ç¡®é…ç½®

### å°ç¨‹åºç«¯

- âœ… ä¸å—å½±å“ï¼Œä»ä½¿ç”¨å°ç¨‹åºåŸç”Ÿå¯¼èˆª
- âœ… è·¯ç”±å·¥å…·å‡½æ•°è‡ªåŠ¨é€‚é…å¹³å°
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰åŠŸèƒ½

## ğŸ“š æ‰©å±•é˜…è¯»

- [Vue Router History æ¨¡å¼](https://router.vuejs.org/guide/essentials/history-mode.html)
- [uniapp H5 è·¯ç”±æ¨¡å¼](https://uniapp.dcloud.net.cn/collocation/pages.html#h5)
- [Nginx Try Files é…ç½®](https://nginx.org/en/docs/http/ngx_http_core_module.html#try_files)

---

**æ€»ç»“**ï¼šé¡¹ç›®å·²æˆåŠŸåˆ‡æ¢åˆ° History æ¨¡å¼ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œ SEO æ”¯æŒï¼ŒåŒæ—¶ä¿æŒäº†è·¨å¹³å°å…¼å®¹æ€§ã€‚ğŸ‰
